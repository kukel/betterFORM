<?xml version="1.0" encoding="UTF-8"?>
<!--
  ~ Copyright (c) 2012. betterFORM Project - http://www.betterform.de
  ~ Licensed under the terms of BSD License
  -->

<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
   <head>
      <meta http-equiv="Content-Type" content="text/xml; charset=UTF-8" />
      <title>betterFORM limeGreen: XForms Dojo Framework - dashboard.xhtml</title>
      <meta name="Author" content="Joern Turner" />
      <meta name="Author" content="Lars Windauer" />
      <meta name="publisher" content="betterFORM Project" />
      <meta name="description" content=" betterFORM allows easy creation of highly dynamic Web 2.0 user interfaces with attractive controls. Add validations, calculations, actions and events to build webapplications." />
      <meta name="keywords" content="betterFORM, xforms, forms, form, xhtml, xpath, xslt, xslt2.0, dojo, dojotoolkit, java, javascript, xml, schema, web, web2.0, web2, web3.0, web3, semantic, semantic web, joern turner, turner, lars windauer, ajax, xforms processor, processor" />
      <meta name="copyright" content="betterForm Project" />
      <meta name="content-language" content="en" />
      <meta name="robots" content="all" />
      <meta http-equiv="expires" content="Wed, 9 Feb 2011 12:21:57 GMT" />
      <meta name="revisit-after" content="2 days" />
      <meta name="google-site-verification" content="L5gmOYcZv-vwF2q0e-qSIXx8ecpKUN8A7lrW4ia9YR0" />
      <link rev="made" href="mailto:info@betterform.de" />
      <link rel="SHORTCUT ICON" href="./images/betterform.ico" />
      <link rel="ICON" href="./images/betterform.ico" type="image/x-icon" />
      <link rel="stylesheet" type="text/css" href="./styles/bf.css" /><style type="text/css">
            #index{
                background:#efefef;
            }
			#logoBar{
				margin-top:42px;
			}
            #content-area{
                background:#efefef;
				min-height:1000px;
				/*position:relative;*/
            }
			.box {
				margin-top: 10px;
				width: 100%;
				top: 110px;
				position: absolute;
				border: 1px solid #BABABA;
			}
			
            #footer{
                display:none;
            }
            #index #sub-header .contentBody a {
                width: 295px;
                height: 100px;
                display: block;
                float: left;
            }

            .pageMarginBox {
                /*width: 890px;*/
                width: 800px;
				position:relative;
            }

            #index #main-content {
                height: 264px;
                background: #D3D3D3;
                display: block; /*float:left;*/
                color: #999;
				height:inherit;
            }

            #index #main-content .col {
                width: 260px;
                float: left;
                margin-top: 23px;
                padding: 0 5px 0 5px;
                line-height: 1.6;
                font-size: 10pt;
            }

            #index #main-content #leftCol {
                width: 565px;
            }
			#index #main-content #leftCol strong{
				font-weight:bold;
			}


            #index #main-content #rightCol {
                margin-right: 0;
                margin-left: 16px;
                color: #888888;
                text-align: center;
                line-height: 0;
                font-size: 1.6em;
            }

            #index #main-content #rightCol a:hover {
                text-decoration: underline;
            }

            .page #bottomMenu {
                float: left;
            }

            #index .languages {
                display: block;
            }
			#browseLink{
				font-size:1em;
			}
			#shadowBottom {
				display:none;
			}
			#sub-header{display:none;}

			.formBrowserHead{
				position:relative;
				margin:6px;
				padding:10px;
				border-bottom:thin solid #999999;
			}
			.formBrowserHead #commands{
				position:absolute;
				right:5px;
				top:10px;
				margin:0;
			}
			.formBrowserHead #commands img{
				width:28px;
				height:28px;
				margin-top:-5px;
				margin-right:-10px;
			}
			#dashboardTitle{
				float:left;
				color:#488aa6;
				font-size:26pt;
				margin-top:22px;
				margin-left:5px;
			}
			.bfFormBrowser #bfListView .parent{
				margin-top:10px;
			}
			#mission{
				display:none;
			}

		.bfFormBrowser .dijitArrowButtonChar,
		.bfFormBrowser .dijitArrowButtonInner {
			display:none;
		}
		.bfFormBrowser .dijitDropDownButton .dijitButtonNode {
			background:transparent;
			border:0;
		}

        </style>

      <!--<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/dojo/1.5/dojo/dojo.xd.js"></script>-->
	  <style type="text/css">
		  @import "resources/scripts/dijit/themes/tundra/tundra.css";
		  @import "resources/scripts/dojo/resources/dojo.css";

        </style>
</head>
   <body id="index" class="tundra">
      <div class="page">
         <div id="header">
            <div class="pageMarginBox">
               <div id="logoBar"><a href="index.html" class="link" id="linkLogo"><img id="logo" src="./images/logo.png" alt="betterFORM project" /></a><div id="dashboardTitle">Dashboard</div>
                  <div id="mission">the XForms way to build the web</div>
                  <div id="topnav"></div>
               </div>
            </div>
         </div>
         <div id="content-area"><img id="shadowTop" src="./images/shad_top.jpg" alt="" />
			 <noscript>
               <div style="border: thin solid ; width: 100%; color: darkred;position:absolute;top:120px;z-index:999;padding:5px;background:orange">Sorry - this site was optimized for use with JavaScript. You won't be able to access all content until you activate JavaScript</div>
            </noscript>
			 <div class="pageMarginBox">
				<div id="loaderImage" style="text-align:center;">
					<img id="bfLogo" src="images/betterform_icon_118x118.png" width="200" height="200" style="margin-top:140px;"/>

				</div>
				 <div id="browser" class="browser">

				 </div>

				 <div id="loaderBox" class="browser" style="opacity:0;">

				 </div>
			 </div>
         </div>
         <div id="footer">
            <div class="pageMarginBox">
               <div class="languages"><a href="./site/en/index.html"><img src="./images/en.png" class="langSelector" alt="english version" title="english version" /></a><a href="./site/de/index.html"><img src="./images/de.png" class="langSelector" alt="deutsch" title="deutsche Version" /></a></div><span id="bottomMenu">
                  © 2010 betterFORM   | <a href="contact.html">contact / impressum</a>  |   </span></div>
         </div>
         <div style="display:none"><img src="./images/b_tryit_hover.png" alt="" /><img src="./images/b_getit_hover.png" alt="" /><img src="./images/b_exploreit_hover.png" alt="" /></div>
      </div>
	  <script type="text/javascript">
		  var djConfig = {
		  debugAtAllCosts: true,
		  dojoBlankHtmlUrl:"/blank.html",
		  isDebug: true };
	  </script>

	  <script type="text/javascript" src="resources/scripts/dojo/dojo.js" djConfig="parseOnLoad:true">&#160;</script>
	  <script type="text/javascript">
            dojo.require("dojo.fx");
            dojo.require("dojox.fx");
            dojo.require("dojo.fx.easing");
			dojo.require("dijit.form.Form");
			dojo.require("dijit.form.Button");
			dojo.require("dojo.io.iframe");

        	dojo.require("dijit.form.TextBox");
			dojo.require("dijit.form.DropDownButton");
			dojo.require("dijit.TooltipDialog");
			dojo.require("dijit.Dialog");

		 	dojo.config.dojoBlankHtmlUrl = '/blank.html';

            function animateOne() {
				var easing1 = dojo.fx.easing["linear"];
				var first = dojo.animateProperty({
					node: "bfLogo",
					duration:600,
					properties:{
						width:{
							start:200,
							end:0,
							unit:"px"
						},
						height:{
							start:200,
							end:200,
							unit:"px"
						},
						opacity:{
							start:1.0,
							end:0.8
						},
						easing:easing1

					},
					onPlay:function(){
						load('/betterform/FormBrowser?path=forms&fragment=true&ajax=load');
					},
					onEnd:function(){
						dojo.style("bfLogo", "display", "none");
						dojo.style(dojo.byId("loaderBox"), "display","block");
					}
				});

				var second = dojo.animateProperty({
					node: "loaderBox",
					duration:600,
					properties:{
						width:{
							start:0,
							end:800,
							unit:"px"
						},
						height:{
							start:800,
							end:800,
							unit:"px"
						},
						opacity:{
							start:0,
							end:0.4
						},
						marginLeft:{
							start:400,
							end:0,
							unit:"px"

						},
						easing:easing1,
						onEnd:function() {
							switchIds();
						}
					}
				});
				var fadeFinal = dojo.fadeIn({
					duration:400,
					node:"loaderBox"
				});
			    var combined = dojo.fx.chain([first,second,fadeFinal]).play();

            }

			/*
			* called from directory links to show contents of collection (link generated by servlet)
			*/
/*
			function viewContent (node, url){
			}

*/
			function viewContent(node, url) {
				var easing1 = dojo.fx.easing["expoIn"];
				var easing2 = dojo.fx.easing["expoOut"];

				var slideToLeft = dojo.animateProperty({
					node: "browser",
					duration:1000,
					delay:100,
					properties:{
						left:{
							start:0,
							end:-2000,
							unit:"px"
						},
						easing:easing1
					}
				});

				var slideFromRight = dojo.animateProperty({
					node: "loaderBox",
					duration:600,

					properties:{
						opacity:{
							start:0,
							end:0.8
						},
						left:{
							start:2000,
							end:0,
							unit:"px"
						},
						easing:easing2,
						beforeBegin:function(){
							console.debug("slideToLeft onBegin:");
							var loaderBox = dojo.byId("loaderBox");
							// console.debug("slideToLeft:",loaderBox);
							dojo.style(loaderBox, "left", "2000px");
							load(url,true);
						}
					}
				});
				var fadeFinal = dojo.fadeIn({
					duration:200,
					node:"loaderBox" ,
					onEnd:function() {
						switchIds();
					}
				});
				var combined = dojo.fx.combine([slideFromRight, slideToLeft]);
				dojo.fx.chain([combined,fadeFinal]).play();

//				slideToLeft.play();
			}

			/*
			* called whenever link to root collection is clicked
			*/
			function viewRoot(node,url){
				viewParent(node,url);
			}

			/*
			* called whenever link to root collection is clicked
			*/
			function viewParent(node,url){
				var easing1 = dojo.fx.easing["expoIn"];
				var easing2 = dojo.fx.easing["expoOut"];

				var slideToRight = dojo.animateProperty({
					node: "browser",
					duration:1000,
					delay:100,
					properties:{
						left:{
							start:0,
							end:2000,
							unit:"px"
						},
						easing:easing1
					}
				});

				var slideFromLeft = dojo.animateProperty({
					node: "loaderBox",
					duration:600,

					properties:{
						opacity:{
							start:0,
							end:0.8
						},
						left:{
							start:-2000,
							end:0,
							unit:"px"
						},
						easing:easing2,
						beforeBegin:function(){
							console.debug("slideFromLeft beforeBegin:");
							var loaderBox = dojo.byId("loaderBox");
							// console.debug("slideToLeft:",loaderBox);
							dojo.style(loaderBox, "left", "-2000px");
							load(url,true);
						}
					}
				});
				var fadeFinal = dojo.fadeIn({
					duration:200,
					node:"loaderBox" ,
					onEnd:function() {
						switchIds();
						var loader = dojo.byId("loaderBox");
						dojo.style(loader, "left","-2000px");
						console.debug("hide Loader box:",loader);
					}
				});
				var combined = dojo.fx.combine([slideFromLeft, slideToRight]);
				dojo.fx.chain([combined,fadeFinal]).play();

			}


			function switchIds() {
				var browser = dojo.byId("browser");
				var loaderBox = dojo.byId("loaderBox");
				dojo.attr(browser, "id", "browserOld");
				dojo.attr(loaderBox, "id", "browser");
				dojo.attr(browser, "id", "loaderBox");
			}



			function load(url, toLoader) {
				//Look up the node we'll stick the text under.
				console.debug("DropDownDialog");
				var popups = dojo.query(".dijitPopup .dijitTooltipDialog");
				popups.forEach(function(item) {
					console.debug("Dijit Popup item: ", item);
					var popUpDijit = dijit.byId(dojo.attr(item,"id"));
					console.debug("destroy popup widget: ",popUpDijit);
					popUpDijit.destroy();
				});
				var targetNode = dojo.byId("loaderBox");

				//The parameters to pass to xhrGet, the url, how to handle it, and the callbacks.
				var xhrArgs = {
					url: url,
					handleAs: "text",
					load: function(data) {
						// console.debug("load", data);
						targetNode.innerHTML = data;
						dojo.parser.parse(targetNode);
						console.debug("inserted Node: ",targetNode);
						// var currentPath=dojo.query(".bfFormBrowserData #current",targetNode);
						// dojox.fx.highlight({node:currentPath, color:'#ffffff', duration:400}).play();
					},
					error: function(error) {
						targetNode.innerHTML = "An unexpected error occurred: " + error;
					}
				};

				//Call the asynchronous xhrGet
				// console.debug("args", xhrArgs);
				var deferred = dojo.xhrGet(xhrArgs);

			}

			dojo.addOnLoad(function() {
				animateOne('/betterform/FormBrowser?path=forms&fragment=true&ajax=load');
			});

			// -->
			function sendFile() {
				var value = dojo.attr(dojo.query(".bfFileUpload")[0], "value");
				if (value == null || value == "") {
					var noFileDialog = new dijit.Dialog({
						title: "Missing file",
						content:"No file to upload was given",
						style: "width: 300px"
					});
					noFileDialog.show();

				} else {
					dojo.io.iframe.send({
						url: "/betterform/FileUpload",
						method: "post",
						handleAs: "text",
						form: dojo.query(".upload")[0],
						load: function(response, ioArgs) {
							//console.log("Upload OK", response, ioArgs);
							var link = dojo.byId("current").childNodes[0];
							console.debug("link: ", link);
							link.onclick();
							return response;
						},
						error: function(response, ioArgs) {
							console.log("Upload FAILED!!!", response, ioArgs);
							return response;
						}
					});
				}
			}

			function createCollection() {
				var controlNode = dojo.query(".bfCollectionName .dijitInputInner")[0];
				var value = dojo.attr(controlNode, "value");
				if (value == null || value == "") {
					var emptyCollectionNameDialog = new dijit.Dialog({
						title: "Collection name is empty",
						content:"Collection was not created.<br/>\n" +
								"<b>Reason</b>: given collection name is empty.",
						style: "width: 300px"
					});
					emptyCollectionNameDialog.show();
				} else {
					dojo.io.iframe.send({
						url: "/betterform/FileUpload",
						method: "post",
						handleAs: "text",
						form: dojo.query(".createCollection")[0],
						load: function(response, ioArgs) {
							console.log("Collection created ", response, ioArgs);
							var link = dojo.byId("current").childNodes[0];
							console.debug("link: ", link);
							link.onclick();
							return response;
						},
						error: function(response, ioArgs) {
							console.log("Creating Collection FAILED!!!", response, ioArgs);
							return response;
						}
					});
				}
			}

			function userInputIsEmpty(/*Class*/ className) {
				console.debug("userInputIsEmpty: Get value of for control with class: ", className);
				var controlNode = dojo.query("." + className + " .dijitInputInner")[0];
				console.debug("userInputIsEmpty: node: ", controlNode);
				var value = dojo.attr(controlNode, "value");
				console.debug("userInputIsEmpty: value: ", value);
				return (value == null || value == "");
			}
	  </script>
   </body>
</html>
